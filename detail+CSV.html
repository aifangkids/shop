<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">å•†å“è©³æƒ…è¼‰å…¥ä¸­...</title>
    
    <style>
        /* ------------------------------------
           é€šç”¨æ¨£å¼ï¼ˆèˆ‡ index.html ä¿æŒä¸€è‡´ï¼‰
        ------------------------------------ */
        @import url('https://fonts.googleapis.com/css2?family=Huninn&display=swap');

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Huninn', 'Noto Sans TC', Arial, sans-serif; 
            color: #333;
            background-color: #fff;
            line-height: 1.5;
            font-size: 14px; 
        }
        
        a {
            text-decoration: none;
            color: inherit;
        }

        ul {
            list-style: none;
        }
        
        button {
            border: none;
            background: none;
            cursor: pointer;
            padding: 0;
            color: inherit;
            font-family: inherit;
        }

        .wrapper {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* ------------------------------------
           é é¦–
        ------------------------------------ */
        #header {
            border-bottom: 1px solid #f0f0f0;
            padding: 15px 0;
            background: #fff;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-inner {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            letter-spacing: -1px;
        }

        .header-icons span {
            font-size: 18px;
            margin-left: 15px;
            cursor: pointer;
        }

        /* ------------------------------------
           è©³æƒ…ä½ˆå±€ (Desktop)
        ------------------------------------ */
        #detail-main {
            display: flex;
            padding: 40px 20px;
            gap: 50px;
            max-width: 1100px;
            margin: 0 auto;
        }

        .image-gallery {
            width: 50%;
            flex-shrink: 0;
        }

        .main-img {
            width: 100%;
            aspect-ratio: 3 / 4;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .thumb-list {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            /* è®“æ»‘å‹•æ›´é †æš¢ */
            padding-bottom: 10px;
            -webkit-overflow-scrolling: touch; 
        }

        .thumb-item {
            width: 70px;
            height: 90px;
            object-fit: cover;
            cursor: pointer;
            border-radius: 4px;
            border: 1px solid #eee;
            transition: border-color 0.2s;
        }

        .thumb-item.active, .thumb-item:hover {
            border-color: #333;
        }

        .info-area {
            width: 50%;
            position: sticky;
            top: 100px; /* è²¼åœ¨ Header ä¸‹æ–¹ */
            align-self: flex-start;
            max-height: calc(100vh - 120px);
            overflow-y: auto;
            padding-bottom: 40px;
        }

        .brand {
            color: #888;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .title {
            font-size: 28px;
            margin-bottom: 15px;
        }

        .price-group {
            margin-bottom: 25px;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }

        .current-price {
            font-size: 24px;
            font-weight: 700;
            color: #e74c3c;
        }

        .original-price {
            text-decoration: line-through;
            color: #aaa;
            margin-left: 10px;
        }

        /* é¸é … */
        .selector {
            margin-bottom: 25px;
        }

        .selector label {
            display: block;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 15px;
        }

        .option-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        /* é¡è‰²é¸æ“‡å™¨ */
        .color-option input[type="radio"] {
            display: none;
        }

        .color-option label {
            /* é¡è‰²æ–¹å¡Šæ¨£å¼ */
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            margin: 0; /* é‡è¨­ label margin */
            transition: transform 0.2s, border-color 0.2s;
            display: inline-block;
            box-shadow: 0 0 0 1px #eee;
        }

        .color-option input[type="radio"]:checked + label {
            border-color: #333;
            transform: scale(1.1);
        }

        /* å°ºå¯¸/è¦æ ¼æŒ‰éˆ• */
        .spec-btn {
            padding: 8px 18px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }

        .spec-btn.active {
            border-color: #333;
            background: #333;
            color: #fff;
        }

        /* è³¼è²·å€å¡Š */
        .buy-actions {
            margin-top: 30px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .btn {
            padding: 15px;
            border-radius: 6px;
            font-weight: 700;
            text-align: center;
            cursor: pointer;
            transition: 0.2s;
            font-size: 16px;
        }

        .btn-cart {
            background: #333;
            color: #fff;
        }

        .btn-now {
            background: #fff;
            border: 1px solid #333;
            color: #333;
        }
        
        /* Tabs å…§å®¹ */
        .tabs {
            margin-top: 50px;
        }

        .tab-nav {
            display: flex;
            border-bottom: 2px solid #eee;
        }

        .tab-link {
            padding: 15px 25px;
            cursor: pointer;
            font-weight: 700;
            color: #888;
            transition: color 0.2s;
        }

        .tab-link.active {
            color: #333;
            border-bottom: 2px solid #333;
            margin-bottom: -2px; /* è®“ active tab è“‹ä½ border */
        }

        .tab-content {
            padding: 30px 0;
        }
        
        .tab-content h4 {
             font-size: 16px;
             margin-top: 20px;
             margin-bottom: 10px;
             color: #555;
        }

        /* ------------------------------------
           éŸ¿æ‡‰å¼å„ªåŒ– (æ‰‹æ©Ÿç‰ˆ)
        ------------------------------------ */
        @media (max-width: 850px) {
            #detail-main { 
                flex-direction: column; 
                padding: 0; 
                gap: 20px; 
            }
            .image-gallery, .info-area { 
                width: 100%; 
                position: static;
                max-height: none;
                overflow-y: visible;
                padding: 0;
            }
            .main-img { 
                border-radius: 0; 
            }
            .info-area { 
                padding: 0 15px 40px; 
            }
            .title { 
                font-size: 24px; 
            }
            .tab-link { 
                padding: 10px 15px; 
                font-size: 14px;
            }
        }
    </style>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
</head>
<body>
    <header id="header">
        <div class="header-inner wrapper">
            <a href="index.html" class="logo">AiFangKids é¸å“</a>
            <div class="header-icons">
                <span onclick="location.href='cart.html'">ğŸ›’</span>
            </div>
        </div>
    </header>

    <main id="detail-main">
        <div class="image-gallery">
            <img id="main-product-img" src="https://via.placeholder.com/600x750?text=Image+Loading" class="main-img" alt="å•†å“ä¸»åœ–">
            <div class="thumb-list" id="thumbnail-list">
                </div>
        </div>

        <div class="info-area">
            <p class="brand" id="product-brand">å“ç‰Œè¼‰å…¥ä¸­</p>
            <h1 class="title" id="product-title">å•†å“åç¨±è¼‰å…¥ä¸­</h1>
            
            <div class="price-group">
                <span class="current-price" id="discount-price-display">0 TWD</span>
                <span class="original-price" id="original-price-display">0 TWD</span>
            </div>

            <div class="selector" id="color-selector">
                <label>é¸æ“‡é¡è‰² (<span id="selected-color-name">è«‹é¸æ“‡</span>)</label>
                <div class="option-grid" id="color-options-grid">
                    </div>
            </div>

            <div class="selector" id="size-selector">
                <label>é¸æ“‡å°ºå¯¸</label>
                <div class="option-grid" id="size-options-grid">
                    </div>
            </div>

            <div class="buy-actions">
                <button class="btn btn-cart" id="btn-add-cart">åŠ å…¥è³¼ç‰©è»Š</button>
                <button class="btn btn-now">ç«‹å³è³¼è²·</button>
            </div>

            <div class="tabs">
                <div class="tab-nav">
                    <div class="tab-link active" onclick="showTab('info')">å•†å“è³‡è¨Š</div>
                    <div class="tab-link" onclick="showTab('size')">å°ºå¯¸è¡¨</div>
                </div>
                
                <div class="tab-content" id="tab-info">
                    <p id="product-description">å•†å“èªªæ˜è¼‰å…¥ä¸­...</p>
                    <h4 id="product-material"></h4>
                    <h4 id="product-suggestions"></h4>
                </div>
                
                <div class="tab-content" id="tab-size" style="display: none;">
                    <img id="size-chart-img" src="" alt="å°ºå¯¸è¡¨åœ–ç‰‡" style="max-width: 100%; height: auto;">
                    <p id="size-chart-note">å°ºå¯¸è¡¨è¼‰å…¥ä¸­...</p>
                </div>
            </div>
        </div>
    </main>
    
    <script>
        // è¨­å®š CSV æª”æ¡ˆè·¯å¾‘
        const PRODUCT_DATA_CSV = 'SHOP å¾Œç«¯åŠæ™‚æ›´æ–°å•†å“è³‡è¨Š - å•†å“è³‡æ–™.csv';
        const DETAIL_DATA_CSV = 'SHOP å¾Œç«¯åŠæ™‚æ›´æ–°å•†å“è³‡è¨Š - è©³ç´°ä»‹ç´¹.csv';

        // ç¢ºä¿è·¯å¾‘æ˜¯ç¶²è·¯å¯å­˜å–çš„ç›¸å°è·¯å¾‘
        function cleanPath(path) {
             // æ›¿æ› Windows çµ•å°è·¯å¾‘çš„é–‹é ­ï¼Œä¸¦å°‡åæ–œç·šæ›¿æ›ç‚ºæ–œç·š
             if (!path) return '';
             let cleaned = path.replace(/C:\\Users\\DCT\\OneDrive\\æ¡Œé¢\\flask_shop/i, '');
             cleaned = cleaned.replace(/\\/g, '/');
             
             // ç¢ºä¿ä»¥ / é–‹é ­ï¼Œä¸¦ç§»é™¤å¯èƒ½å­˜åœ¨çš„ static/images é‡è¤‡
             if (!cleaned.startsWith('/')) {
                 cleaned = '/' + cleaned;
             }
             return cleaned.replace(/\/\/+/g, '/').replace('/static/images', '/static/images'); // å‡è¨­ /static/images æ˜¯æ ¹ç›®éŒ„
        }

        // é¡¯ç¤º Tab å…§å®¹
        window.showTab = function(tabId) {
            document.getElementById('tab-info').style.display = 'none';
            document.getElementById('tab-size').style.display = 'none';
            
            document.querySelector('.tab-nav .active').classList.remove('active');
            
            document.getElementById('tab-' + tabId).style.display = 'block';
            document.querySelector(`[onclick="showTab('${tabId}')"]`).classList.add('active');
        }


        // ä¸»è¦è¼‰å…¥å‡½æ•¸
        function loadProductDetails() {
            // 1. å¾ URL ç²å–è²¨è™Ÿ
            const urlParams = new URLSearchParams(window.location.search);
            const itemCode = urlParams.get('item_code');

            if (!itemCode) {
                document.getElementById('product-title').textContent = 'éŒ¯èª¤ï¼šç¼ºå°‘å•†å“è²¨è™Ÿã€‚';
                return;
            }
            
            let productData = null;
            let detailData = null;

            // è¼”åŠ©å‡½æ•¸ï¼šè§£æ CSV
            const parseCSV = (url) => new Promise((resolve, reject) => {
                Papa.parse(url, {
                    download: true,
                    header: true,
                    skipEmptyLines: true,
                    complete: (results) => resolve(results.data),
                    error: (error) => reject(error)
                });
            });

            // 2. åŒæ™‚è¼‰å…¥å…©å€‹ CSV
            Promise.all([
                parseCSV(PRODUCT_DATA_CSV),
                parseCSV(DETAIL_DATA_CSV)
            ]).then(([products, details]) => {
                
                // 3. æ ¹æ“šè²¨è™ŸæŸ¥æ‰¾è³‡æ–™
                productData = products.find(item => item['è²¨è™Ÿ'] === itemCode);
                detailData = details.find(item => item['è²¨è™Ÿ'] === itemCode);

                if (!productData) {
                    document.getElementById('product-title').textContent = `éŒ¯èª¤ï¼šæ‰¾ä¸åˆ°è²¨è™Ÿç‚º ${itemCode} çš„å•†å“è³‡è¨Šã€‚`;
                    return;
                }

                // 4. æ¸²æŸ“ä¸»è¦è³‡è¨Š
                document.getElementById('page-title').textContent = `${productData['å•†å“åç¨±']} - ${productData['å“ç‰Œ']} è©³ç´°è³‡è¨Š`;
                document.getElementById('product-brand').textContent = productData['å“ç‰Œ'];
                document.getElementById('product-title').textContent = productData['å•†å“åç¨±'];
                document.getElementById('original-price-display').textContent = `${productData['åƒ¹æ ¼']} TWD`;
                // ä½¿ç”¨ 20%OFF åƒ¹æ ¼
                document.getElementById('discount-price-display').textContent = `${productData['åƒ¹æ ¼-20%OFF']} TWD`;
                
                // 5. æ¸²æŸ“åœ–ç‰‡
                renderImages(productData);

                // 6. æ¸²æŸ“é¡è‰²èˆ‡å°ºå¯¸é¸é …
                renderOptions(productData);
                
                // 7. æ¸²æŸ“è©³ç´°ä»‹ç´¹ Tab
                renderDetailTabs(detailData);

            }).catch(error => {
                console.error("è¼‰å…¥ CSV æª”æ¡ˆå¤±æ•—:", error);
                document.getElementById('product-title').textContent = 'éŒ¯èª¤ï¼šå•†å“è³‡æ–™è¼‰å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥ CSV æª”æ¡ˆè·¯å¾‘ã€‚';
            });
        }
        
        // åœ–ç‰‡æ¸²æŸ“å‡½æ•¸
        function renderImages(data) {
            const mainImgEl = document.getElementById('main-product-img');
            const thumbListEl = document.getElementById('thumbnail-list');
            
            // a. ä¸»åœ–
            mainImgEl.src = cleanPath(data['ä¸»åœ–é€£çµ']);
            mainImgEl.classList.add('active'); // é è¨­ç‚ºä¸»åœ–
            
            // b. ç¸®åœ– (å¤šè‰²åœ–ç‰‡é€£çµ)
            thumbListEl.innerHTML = '';
            
            // æ¸…ç†ä¸¦åˆ†å‰²å¤šè‰²åœ–ç‰‡é€£çµ
            // æ ¼å¼: é¡è‰²åç¨±#åœ–ç‰‡è·¯å¾‘ï¼›é¡è‰²åç¨±#åœ–ç‰‡è·¯å¾‘ï¼›...
            const multiColorImagesString = data['å¤šè‰²åœ–ç‰‡é€£çµ'] || '';
            const colorImages = multiColorImagesString.split('ï¼›').filter(s => s.trim() !== '');
            
            // åŠ ä¸Šä¸»åœ–ç¸®åœ–
            const mainThumb = document.createElement('img');
            mainThumb.src = cleanPath(data['ä¸»åœ–é€£çµ']);
            mainThumb.className = 'thumb-item active';
            mainThumb.onclick = () => {
                mainImgEl.src = cleanPath(data['ä¸»åœ–é€£çµ']);
                document.querySelectorAll('.thumb-item').forEach(el => el.classList.remove('active'));
                mainThumb.classList.add('active');
            };
            thumbListEl.appendChild(mainThumb);
            
            colorImages.forEach(colorImageStr => {
                const parts = colorImageStr.split('#');
                if (parts.length < 2) return;
                
                const imgPath = parts[1].trim();
                const thumbImgEl = document.createElement('img');
                thumbImgEl.src = cleanPath(imgPath);
                thumbImgEl.className = 'thumb-item';
                
                thumbImgEl.onclick = () => {
                    mainImgEl.src = cleanPath(imgPath);
                    document.querySelectorAll('.thumb-item').forEach(el => el.classList.remove('active'));
                    thumbImgEl.classList.add('active');
                };
                thumbListEl.appendChild(thumbImgEl);
            });
        }
        
        // é¸é …æ¸²æŸ“å‡½æ•¸
        function renderOptions(data) {
            const colorGrid = document.getElementById('color-options-grid');
            const sizeGrid = document.getElementById('size-options-grid');
            const selectedColorName = document.getElementById('selected-color-name');
            
            // A. é¡è‰² (å‡è¨­ CSV ä¸­çš„ 'é¡è‰²' æ¬„ä½æ˜¯ 'é¡è‰²åç¨±#è·¯å¾‘ï¼›é¡è‰²åç¨±#è·¯å¾‘' çš„æ ¼å¼ï¼Œæˆ‘å€‘åªå–åç¨±)
            colorGrid.innerHTML = '';
            const colorString = data['é¡è‰²'] || '';
            const colors = colorString.split('ï¼›').map(c => c.split('#')[0].trim()).filter(c => c !== '');
            
            colors.forEach((colorName, index) => {
                const inputId = `color-${index}`;
                // é€™è£¡æˆ‘å€‘æ²’æœ‰è‰²ç¢¼ï¼Œæ‰€ä»¥æš«æ™‚ç”¨ä¸€å€‹é€šç”¨èƒŒæ™¯è‰²
                const colorHtml = `
                    <div class="color-option">
                        <input type="radio" id="${inputId}" name="color" value="${colorName}">
                        <label for="${inputId}" data-color-name="${colorName}" 
                               style="background-color: #f7f7f7;" title="${colorName}"></label>
                    </div>
                `;
                colorGrid.innerHTML += colorHtml;
            });
            
            // é¡è‰²é¸æ“‡é‚è¼¯ (é»æ“Šé¡¯ç¤ºåç¨±)
            colorGrid.querySelectorAll('input[name="color"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.checked) {
                        const name = this.nextElementSibling.getAttribute('data-color-name');
                        selectedColorName.textContent = name;
                    }
                });
            });


            // B. å°ºå¯¸ (CSV å°ºå¯¸æ ¼å¼: S | 2~3y 100~110cm, JS | 7~8y 135~cm ( TWD 630 ))
            sizeGrid.innerHTML = '';
            const sizeString = data['å°ºå¯¸'] || '';
            const sizes = sizeString.split(',').map(s => s.trim()).filter(s => s !== '');

            sizes.forEach((sizeDetail, index) => {
                const sizeNameMatch = sizeDetail.match(/^([^|\s]+)/); // æå– S, JS
                const sizeName = sizeNameMatch ? sizeNameMatch[1] : `å°ºå¯¸${index+1}`;
                
                const sizeBtn = document.createElement('div');
                sizeBtn.className = 'spec-btn';
                sizeBtn.textContent = sizeDetail.trim().replace(/\(.*\)/, '').trim(); // ç§»é™¤æ‹¬è™Ÿå…§çš„åŠ åƒ¹è³‡è¨Š
                sizeBtn.setAttribute('data-size', sizeName);

                sizeBtn.onclick = () => {
                    sizeGrid.querySelectorAll('.spec-btn').forEach(btn => btn.classList.remove('active'));
                    sizeBtn.classList.add('active');
                };
                sizeGrid.appendChild(sizeBtn);
            });
        }
        
        // è©³ç´°ä»‹ç´¹ Tab æ¸²æŸ“å‡½æ•¸
        function renderDetailTabs(data) {
            if (!data) return;

            // å•†å“è³‡è¨Š Tab
            document.getElementById('product-description').innerHTML = data['å•†å“èªªæ˜'].replace(/\n/g, '<br>'); // æ›è¡Œç¬¦è™Ÿè½‰ <br>
            document.getElementById('product-material').innerHTML = `<h4>æè³ªï¼š${data['æè³ª']}</h4>`;
            document.getElementById('product-suggestions').innerHTML = `<h4>ç©¿æ­å»ºè­°ï¼š${data['ç©¿æ­å»ºè­°']}</h4>`;
            
            // å°ºå¯¸è¡¨ Tab
            const sizeChartImg = document.getElementById('size-chart-img');
            const sizeChartNote = document.getElementById('size-chart-note');
            
            if (data['å°ºå¯¸è¡¨']) {
                sizeChartImg.src = cleanPath(data['å°ºå¯¸è¡¨']);
                sizeChartNote.style.display = 'none';
            } else {
                sizeChartImg.style.display = 'none';
                sizeChartNote.textContent = 'æœªæä¾›è©³ç´°å°ºå¯¸è¡¨åœ–ç‰‡ã€‚';
            }
        }


        window.onload = loadProductDetails;

// **æ–°å¢ï¼šè³¼ç‰©è»Šç›¸é—œçš„å…¨å±€è®Šæ•¸å’Œå‡½æ•¸**
let currentSelectedProduct = {}; // ç”¨æ–¼å„²å­˜ç•¶å‰é é¢å•†å“çš„å®Œæ•´æ•¸æ“š

function getCart() {
    // å¾ç€è¦½å™¨å„²å­˜ç©ºé–“è®€å–è³¼ç‰©è»Šè³‡æ–™
    const cart = localStorage.getItem('shoppingCart');
    return cart ? JSON.parse(cart) : [];
}

function saveCart(cart) {
    // å„²å­˜è³¼ç‰©è»Šè³‡æ–™åˆ°ç€è¦½å™¨
    localStorage.setItem('shoppingCart', JSON.stringify(cart));
}

// **ä¿®æ”¹ï¼šé¸é …æ¸²æŸ“å‡½æ•¸ (å¢åŠ è¿½è¹¤é¸ä¸­ç‹€æ…‹)**
function renderOptions(data) {
    // å°‡ç•¶å‰å•†å“è³‡æ–™å­˜å…¥å…¨å±€è®Šæ•¸
    currentSelectedProduct = data;

    const colorGrid = document.getElementById('color-options-grid');
    const sizeGrid = document.getElementById('size-options-grid');
    const selectedColorName = document.getElementById('selected-color-name');
    
    // A. é¡è‰²
    colorGrid.innerHTML = '';
    const colorString = data['é¡è‰²'] || '';
    const colors = colorString.split('ï¼›').map(c => c.split('#')[0].trim()).filter(c => c !== '');
    
    colors.forEach((colorName, index) => {
        const inputId = `color-${index}`;
        const colorHtml = `
            <div class="color-option">
                <input type="radio" id="${inputId}" name="color" value="${colorName}">
                <label for="${inputId}" data-color-name="${colorName}" 
                       style="background-color: #f7f7f7;" title="${colorName}"></label>
            </div>
        `;
        colorGrid.innerHTML += colorHtml;
    });
    
    // é¡è‰²é¸æ“‡é‚è¼¯ (é»æ“Šæ™‚è¨˜éŒ„ä¸¦é¡¯ç¤ºåç¨±)
    colorGrid.querySelectorAll('input[name="color"]').forEach(radio => {
        radio.addEventListener('change', function() {
            if (this.checked) {
                const name = this.nextElementSibling.getAttribute('data-color-name');
                selectedColorName.textContent = name;
                // è¨˜éŒ„é¸ä¸­çš„é¡è‰²
                currentSelectedProduct.selectedColor = name; 
            }
        });
    });


    // B. å°ºå¯¸ (CSV å°ºå¯¸æ ¼å¼: S | 2~3y 100~110cm, JS | 7~8y 135~cm ( TWD 630 ))
    sizeGrid.innerHTML = '';
    const sizeString = data['å°ºå¯¸'] || '';
    const sizes = sizeString.split(',').map(s => s.trim()).filter(s => s !== '');

    sizes.forEach((sizeDetail, index) => {
        const sizeNameMatch = sizeDetail.match(/^([^|\s]+)/); // æå– S, JS
        const sizeName = sizeNameMatch ? sizeNameMatch[1] : `å°ºå¯¸${index+1}`;
        
        const sizeBtn = document.createElement('div');
        sizeBtn.className = 'spec-btn';
        // é¡¯ç¤ºå°ºå¯¸ä»£è™Ÿå’Œèªªæ˜ï¼Œä½†ä¸é¡¯ç¤ºæ‹¬è™Ÿå…§çš„åŠ åƒ¹è³‡è¨Š
        sizeBtn.textContent = sizeDetail.trim().replace(/\(.*\)/, '').trim(); 
        sizeBtn.setAttribute('data-size', sizeDetail.trim()); // å„²å­˜å®Œæ•´çš„å°ºå¯¸å­—ä¸²
        sizeBtn.setAttribute('data-size-name', sizeName); // å„²å­˜å°ºå¯¸ä»£è™Ÿ (S, JS)

        sizeBtn.onclick = () => {
            sizeGrid.querySelectorAll('.spec-btn').forEach(btn => btn.classList.remove('active'));
            sizeBtn.classList.add('active');
            // è¨˜éŒ„é¸ä¸­çš„å°ºå¯¸ (å®Œæ•´çš„å°ºå¯¸å­—ä¸²ï¼ŒåŒ…å«åƒ¹æ ¼è³‡è¨Š)
            currentSelectedProduct.selectedSizeDetail = sizeDetail.trim(); 
        };
        sizeGrid.appendChild(sizeBtn);
    });
}

// **æ–°å¢ï¼šåŠ å…¥è³¼ç‰©è»Šå‡½æ•¸**
function addToCart() {
    const color = currentSelectedProduct.selectedColor;
    const sizeDetail = currentSelectedProduct.selectedSizeDetail;

    if (!color || !sizeDetail) {
        alert('è«‹å…ˆé¸æ“‡é¡è‰²å’Œå°ºå¯¸ï¼');
        return;
    }
    
    let cart = getCart();

    // è³¼ç‰©è»Šé …ç›® ID (ç”¨æ–¼è¾¨è­˜åŒä¸€å•†å“çš„ SKU)
    const itemId = `${currentSelectedProduct['è²¨è™Ÿ']}-${color}-${sizeDetail}`;

    // æª¢æŸ¥è³¼ç‰©è»Šä¸­æ˜¯å¦å·²æœ‰æ­¤ SKU
    const existingItem = cart.find(item => item.id === itemId);

    if (existingItem) {
        // å¦‚æœå·²å­˜åœ¨ï¼Œæ•¸é‡ +1
        existingItem.qty += 1;
    } else {
        // å¦‚æœæ˜¯æ–°é …ç›®
        const newItem = {
            id: itemId, // å”¯ä¸€çš„ SKU è­˜åˆ¥ç¢¼
            code: currentSelectedProduct['è²¨è™Ÿ'],
            name: currentSelectedProduct['å•†å“åç¨±'],
            color: color,
            // ç”±æ–¼ CSV ä¸­åƒ¹æ ¼åœ¨å°ºå¯¸æ¬„ä½ï¼Œé€™è£¡éœ€è¦å¾å°ºå¯¸å­—ä¸²ä¸­æå–æœ€çµ‚åƒ¹æ ¼
            price: currentSelectedProduct['åƒ¹æ ¼-20%OFF'], // é è¨­ä½¿ç”¨ 20% OFF åƒ¹æ ¼
            sizeDetail: sizeDetail, // å„²å­˜å®Œæ•´çš„å°ºå¯¸å­—ä¸² (å«åŠ åƒ¹è³‡è¨Š)
            qty: 1,
            selected: true,
            imageUrl: cleanPath(currentSelectedProduct['ä¸»åœ–é€£çµ']),
        };
        
        // æª¢æŸ¥å°ºå¯¸æ¬„ä½æ˜¯å¦æœ‰åŠ åƒ¹ ( TWD 630 )ï¼Œä¸¦è¦†è“‹åƒ¹æ ¼
        const priceMatch = sizeDetail.match(/\( TWD (\d+)\s*\)/);
        if (priceMatch) {
            newItem.price = parseInt(priceMatch[1], 10);
        }

        cart.push(newItem);
    }
    
    saveCart(cart);
    alert(`å·²å°‡ ${color} / ${sizeDetail.split('|')[0].trim()} åŠ å…¥è³¼ç‰©è»Šï¼`);
    // å¯ä»¥é¸æ“‡å°èˆªåˆ°è³¼ç‰©è»Šé é¢
    // window.location.href = 'cart.html'; 
}

// **æ–°å¢ï¼šç¶å®šæŒ‰éˆ•äº‹ä»¶**
document.addEventListener('DOMContentLoaded', () => {
    // ç¢ºä¿ loadProductDetails åœ¨ DOM å…§å®¹è¼‰å…¥å¾ŒåŸ·è¡Œ
    loadProductDetails(); 
    
    // ç¶å®šã€ŒåŠ å…¥è³¼ç‰©è»Šã€æŒ‰éˆ•
    const addToCartButton = document.getElementById('btn-add-cart');
    if (addToCartButton) {
        addToCartButton.addEventListener('click', addToCart);
    }
});
    </script>
</body>
</html>