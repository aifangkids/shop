<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BELLOT Style | Official</title>
    <link rel="icon" href="./favicon.ico" type="image/x-icon">
    
    <style>
        /* --- 1. 字體設定 (使用本地路徑) --- */
        @font-face {
            font-family: 'NotoSansKR';
            src: url('./fonts/NotoSansKR-Thin.ttf') format('truetype');
            font-weight: 100;
        }
        @font-face {
            font-family: 'NotoSansKR';
            src: url('./fonts/NotoSansKR-Light.ttf') format('truetype');
            font-weight: 300;
        }
        @font-face {
            font-family: 'NotoSansKR';
            src: url('./fonts/NotoSansKR-Regular.ttf') format('truetype');
            font-weight: 400;
        }
        @font-face {
            font-family: 'NotoSansKR';
            src: url('./fonts/NotoSansKR-Medium.ttf') format('truetype');
            font-weight: 500;
        }

        :root { 
            --sidebar-width: 260px; 
            --accent: #d9534f; 
            --new-color: #5cb85c; 
            --header-h: 80px; 
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: 'NotoSansKR', sans-serif; 
            background: #fff; 
            color: #333; 
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* --- 2. 頂部導覽 (對稱佈局) --- */
        .top-header {
            width: 100%; height: var(--header-h); background: #fff;
            position: fixed; top: 0; left: 0; z-index: 1200;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 25px; border-bottom: 1px solid #f2f2f2;
        }
        .header-icon { width: 22px; height: 22px; cursor: pointer; object-fit: contain; }
        /* 品牌 Logo 始終置中 */
        .main-logo { height: 38px; cursor: pointer; position: absolute; left: 50%; transform: translateX(-50%); }

        /* --- 3. 側欄佈局 --- */
        .sidebar {
            width: var(--sidebar-width); height: 100vh; position: fixed;
            left: 0; top: 0; border-right: 1px solid #eee;
            padding: calc(var(--header-h) + 40px) 30px 50px; background: #fff; z-index: 1100; overflow-y: auto;
            transition: transform 0.4s ease;
        }
        .filter-title { 
            font-size: 12px; font-weight: 500; letter-spacing: 2px; 
            margin-bottom: 20px; text-transform: uppercase; 
            border-bottom: 1px solid #f0f0f0; padding-bottom: 8px; 
        }
        .category-menu { list-style: none; }
        .category-menu li { font-size: 13px; font-weight: 400; margin-bottom: 15px; color: #888; cursor: pointer; transition: 0.3s; }
        .category-menu li:hover, .category-menu li.active { color: #000; font-weight: 500; }

        /* 品牌次分類：取消方框，僅保留文字變化 */
        .brand-panel { max-height: 0; overflow: hidden; transition: max-height 0.5s ease; background: #fafafa; padding: 0 10px; border-radius: 4px; }
        .brand-panel.open { max-height: 500px; padding: 15px 10px; margin-bottom: 20px; }
        .brand-item { 
            display: block; font-size: 11px; font-weight: 300; 
            color: #999; margin-bottom: 10px; cursor: pointer; 
            transition: 0.2s;
        }
        .brand-item.selected { color: #000; font-weight: 500; }

        /* --- 4. 主內容區與商品卡 --- */
        .main-content { 
            width: 100%; 
            padding: calc(var(--header-h) + 50px) 50px 80px calc(var(--sidebar-width) + 40px); 
            transition: opacity 1s ease; opacity: 0; 
        }
        .main-content.loaded { opacity: 1; }

        .product-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 40px 20px; }
        .product-card { cursor: pointer; text-align: center; }
        
        .img-wrap { 
            width: 100%; aspect-ratio: 3/4; background-size: cover; background-position: center; 
            background-color: #f9f9f9; margin-bottom: 15px; position: relative; overflow: hidden;
        }
        .status-badge { 
            position: absolute; top: 10px; left: 10px; padding: 4px 8px; 
            font-size: 10px; font-weight: 500; color: #fff; z-index: 10;
        }
        .badge-NEW { background: var(--new-color); }
        .badge-SALE { background: var(--accent); }

        .p-name { font-size: 13px; font-weight: 300; color: #555; margin-bottom: 8px; height: 38px; overflow: hidden; line-height: 1.5; }
        .color-row { display: flex; justify-content: center; gap: 6px; margin: 10px 0; }
        .color-dot { width: 12px; height: 12px; border: 1px solid #eee; border-radius: 2px; }
        .p-price { font-size: 14px; font-weight: 500; color: #111; }

        /* --- 5. 工具組 --- */
        .fixed-tools { position: fixed; bottom: 30px; right: 20px; z-index: 2000; display: flex; flex-direction: column; gap: 10px; }
        .tool-btn { 
            width: 45px; height: 45px; background: #fff; border: 1px solid #eee; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 10px; font-weight: 500; cursor: pointer; transition: 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .tool-btn:hover { background: #000; color: #fff; }
        .line-btn { background: #06C755; color: #fff; border: none; }

        /* --- 6. 響應式修正 --- */
        @media (max-width: 900px) {
            .sidebar { transform: translateX(-100%); left: 0; box-shadow: 10px 0 30px rgba(0,0,0,0.05); }
            .sidebar.open { transform: translateX(0); }
            .main-content { padding: calc(var(--header-h) + 30px) 15px 80px 15px; }
            .product-grid { grid-template-columns: repeat(2, 1fr); gap: 30px 15px; }
            .sidebar-overlay.active { display: block; }
        }

        .sidebar-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.3); z-index: 1050; display: none; }
        
        /* 彈窗 */
        #popup-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 9999; display: none; justify-content: center; align-items: center; }
        .popup-box { position: relative; background: #fff; max-width: 400px; width: 85%; }
        .popup-close { position: absolute; bottom: -30px; right: 0; color: #fff; cursor: pointer; font-size: 12px; font-weight: 300; }
    </style>
</head>
<body>

    <header class="top-header">
        <img src="./images/ui/menu.png" class="header-icon" onclick="toggleMenu()" alt="Menu">
        <img src="./images/ui/logo.png" class="main-logo" onclick="location.reload()" alt="BELLOT">
        <img src="./images/ui/icon_tcart.png" class="header-icon" onclick="toggleCart()" alt="Cart">
    </header>

    <div id="overlay" class="sidebar-overlay" onclick="closeMenu()"></div>

    <div id="popup-overlay">
        <div class="popup-box">
            <img id="popup-img" style="width:100%; display:block;">
            <div class="popup-close" onclick="closePopup()">CLOSE [X]</div>
        </div>
    </div>

    <div class="fixed-tools">
        <div class="tool-btn" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">TOP</div>
        <div class="tool-btn line-btn" onclick="window.open('https://line.me/R/ti/p/@844bwwjl', '_blank')">LINE</div>
    </div>

    <aside id="sidebar" class="sidebar">
        <div class="filter-section">
            <p class="filter-title">Category</p>
            <ul class="category-menu">
                <li onclick="filterByCat('All')" class="active">ALL ITEMS</li>
                <li onclick="filterByCat('TOP')">TOP</li>
                <li onclick="filterByCat('BOTTOM')">BOTTOM</li>
                <li onclick="filterByCat('SET')">SET</li>
                <li onclick="filterByCat('OUTRE')">OUTRE</li>
                <li onclick="filterByCat('BEBE')">BEBE</li>
                <li onclick="filterByCat('FAMILY')">FAMILY</li>
                <li onclick="filterByCat('ACC')">ACC</li>
            </ul>
        </div>
        <div id="brand-area" class="brand-panel">
            <p class="filter-title" style="font-size: 10px; border:none; margin-top:10px;">Select Brand</p>
            <div id="brand-list"></div>
        </div>
    </aside>

    <main id="main-content" class="main-content">
        <div id="product-list" class="product-grid"></div>
    </main>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbwdGXe894aMoE9Hwedj-bfqHdzpOLYk72c2jVWRipFq07cLGiSRRHZaEcIYhvGWD7qx/exec"; 
        let allData = [];
        let activeCat = 'All';
        let activeBrands = new Set();

        async function fetchData() {
            showRandomPopup();
            try {
                const res = await fetch(API_URL);
                allData = await res.json();
                render(allData);
                document.getElementById('main-content').classList.add('loaded');
            } catch (e) { console.error(e); }
        }

        function render(items) {
            const container = document.getElementById('product-list');
            container.innerHTML = "";
            items.forEach(item => {
                const s = (item.status || item.Status || "").toString().trim().toUpperCase();
                const badgeHtml = s ? `<span class="status-badge badge-${s}">${s}</span>` : "";
                const rawColors = (item.color_code || item.Color_code || "").toString();
                const colors = rawColors ? rawColors.split(',') : [];
                let colorHtml = '<div class="color-row">';
                colors.forEach(c => { 
                    const hex = c.trim();
                    if(hex.startsWith('#')) colorHtml += `<div class="color-dot" style="background:${hex}"></div>`; 
                });
                colorHtml += '</div>';

                const card = document.createElement('div');
                card.className = 'product-card';
                card.innerHTML = `<div class="img-wrap" style="background-image: url('${item.image_url}')">${badgeHtml}</div>
                    <div class="info-wrap"><p class="p-name">${item.name}</p>${colorHtml}<p class="p-price">NT$ ${Number(item.price).toLocaleString()}</p></div>`;
                container.appendChild(card);
            });
        }

        function toggleMenu() {
            if(window.innerWidth <= 900) {
                document.getElementById('sidebar').classList.add('open');
                document.getElementById('overlay').classList.add('active');
            } else {
                // 電腦版選單原本就固定顯示，點擊可作為開關功能（若未來需要）
                const sb = document.getElementById('sidebar');
                const mc = document.getElementById('main-content');
                if(sb.style.transform === 'translateX(-100%)') {
                    sb.style.transform = 'translateX(0)';
                    mc.style.paddingLeft = 'calc(var(--sidebar-width) + 40px)';
                } else {
                    sb.style.transform = 'translateX(-100%)';
                    mc.style.paddingLeft = '40px';
                }
            }
        }
        function closeMenu() {
            document.getElementById('sidebar').classList.remove('open');
            document.getElementById('overlay').classList.remove('active');
        }
        function toggleCart() { alert("購物車預覽即將推出"); }

        function filterByCat(cat) {
            activeCat = cat; activeBrands.clear();
            document.querySelectorAll('.category-menu li').forEach(li => li.classList.toggle('active', li.innerText === cat));
            const filtered = cat === 'All' ? allData : allData.filter(p => p.category === cat);
            const area = document.getElementById('brand-area');
            if(cat === 'All') { area.classList.remove('open'); } 
            else {
                area.classList.add('open');
                const brands = [...new Set(filtered.map(p => p.brand))].filter(b => b);
                document.getElementById('brand-list').innerHTML = brands.map(b => 
                    `<div class="brand-item" onclick="toggleBrand('${b}')" id="b-${b}">${b}</div>`).join('');
            }
            render(filtered);
        }

        function toggleBrand(b) {
            const el = document.getElementById(`b-${b}`);
            if(activeBrands.has(b)) {
                activeBrands.delete(b);
                el.classList.remove('selected');
            } else {
                activeBrands.add(b);
                el.classList.add('selected');
            }
            let final = allData.filter(p => p.category === activeCat);
            if(activeBrands.size > 0) final = final.filter(p => activeBrands.has(p.brand));
            render(final);
        }

        function showRandomPopup() {
            const pops = ['./images/popup/popup_01.jpg', './images/popup/popup_02.jpg', './images/popup/popup_03.jpg'];
            document.getElementById('popup-img').src = pops[Math.floor(Math.random() * pops.length)];
            document.getElementById('popup-overlay').style.display = 'flex';
        }
        function closePopup() { document.getElementById('popup-overlay').style.display = 'none'; }

        window.onload = fetchData;
    </script>
</body>
</html>